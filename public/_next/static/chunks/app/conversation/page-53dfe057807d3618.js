(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{2829:function(e,t,o){Promise.resolve().then(o.bind(o,1954))},1954:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return c}});var n=o(7437),r=o(2265),l=o(5775),i=o.n(l),s=o(2084);let a=i()(()=>o.e(160).then(o.bind(o,5160)).then(e=>e.default),{loadableGenerated:{webpack:()=>[5160]},ssr:!1});function c(){let{user:e,isLoading:t}=(0,s.a)();return((0,r.useEffect)(()=>{if(console.log("User data in ConversationPage:",e),t){console.log("Still loading user, skipping socket init for now.");return}if(e){console.log("Initializing socket with user ID:",e.id);try{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(!e)return console.warn("Cannot initialize WebSocket: Missing userId");console.log("Socket initialization with available data:",{userId:e,voiceId:t||"[will be fetched]",firstName:o||"[not provided]",lastName:n||"[not provided]",dob:r||"[not provided]",profileDocument:l||"[not provided]"});try{let e="https:"===window.location.protocol?"wss:":"ws:",t=window.location.hostname,o="".concat(e,"//").concat(t,":8080"),n=new WebSocket(o);n.onopen=()=>console.log("WebSocket connection established"),n.onerror=e=>console.error("WebSocket error:",e),n.onclose=e=>console.log("WebSocket closed: ".concat(e.code," ").concat(e.reason)),n.onmessage=e=>console.log("Message from server:",e.data)}catch(e){return console.error("Error during socket initialization:",e),null}}(e.id||"")}catch(e){console.error("Error initializing socket:",e)}}else console.warn("No user found after loading, skipping socket initialization.");return document.body.style.backgroundColor="#0f172a",document.documentElement.style.backgroundColor="#0f172a",document.body.classList.add("conversation-page"),()=>{document.body.style.backgroundColor="",document.documentElement.style.backgroundColor="",document.body.classList.remove("conversation-page")}},[e,t]),t)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-[#0a102a]",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-20 h-20 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,n.jsx)("p",{className:"mt-4 text-slate-300",children:"Loading conversation..."})]})}):e?(0,n.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen",children:(0,n.jsx)(a,{userName:e.firstName||"User",memorializedName:e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.lastName||e.firstName||"AI Assistant",onConversationEnd:()=>console.log("Conversation ended"),userDob:e.dob||""})}):(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-[#0a102a]",children:(0,n.jsxs)("div",{className:"p-8 bg-slate-800 rounded-lg shadow-lg max-w-md text-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-medium text-white mb-4",children:"Login Required"}),(0,n.jsx)("p",{className:"text-slate-300 mb-6",children:"Please log in to access the conversation."}),(0,n.jsx)("button",{onClick:()=>window.location.href="/login",className:"w-full py-2 px-4 bg-blue-600 hover:bg-blue-500 transition-colors text-white font-medium rounded-lg flex items-center justify-center",children:"Go to Login"})]})})}},2084:function(e,t,o){"use strict";o.d(t,{a:function(){return s},d:function(){return i}});var n=o(7437),r=o(2265);let l=(0,r.createContext)(void 0),i=e=>{let{children:t}=e,[o,i]=(0,r.useState)(null),[s,a]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(()=>{try{let e=document.cookie.split("; ").find(e=>e.startsWith("userId="));if(e){let t=e.split("=")[1];console.log("Found user cookie with ID:",t),fetch("/api/user/login_credentials?userId=".concat(t)).then(e=>e.json()).then(e=>{if(!e.error){let t={id:e.userId,username:e.userId,firstName:e.firstName,middleName:e.middleName||"",lastName:e.lastName,email:e.email,phone:e.phoneNumber,dob:e.dateOfBirth};i(t),localStorage.setItem("aliveHereUser",JSON.stringify(t))}a(!1)}).catch(()=>{a(!1)});return}let t=localStorage.getItem("aliveHereUser");t&&(console.log("Loading user from localStorage"),i(JSON.parse(t)))}catch(e){console.error("Error loading user from storage:",e)}finally{a(!1)}})()},[]);let c=e=>{console.log("Setting user with ID:",null==e?void 0:e.id),e&&!e.id&&console.error("User object is missing ID field"),i(e),e?localStorage.setItem("aliveHereUser",JSON.stringify(e)):localStorage.removeItem("aliveHereUser")},d=async()=>{try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){console.error("Error during logout:",e)}finally{c(null),document.cookie="userId=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}},u=async e=>{try{c(e)}catch(e){throw console.error("Error registering user:",e),e}};return(0,n.jsx)(l.Provider,{value:{user:o,setUser:c,logout:d,isLoading:s,registerUser:u},children:t})},s=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},5775:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let n=o(7043);o(7437),o(2265);let r=n._(o(5602));function l(e,t){var o;let n={loading:e=>{let{error:t,isLoading:o,pastDelay:n}=e;return null}};"function"==typeof e&&(n.loader=e);let l={...n,...t};return(0,r.default)({...l,modules:null==(o=l.loadableGenerated)?void 0:o.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1523:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let n=o(8993);function r(e){let{reason:t,children:o}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return o}},5602:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let n=o(7437),r=o(2265),l=o(1523),i=o(49);function s(e){return{default:e&&"default"in e?e.default:e}}let a={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},c=function(e){let t={...a,...e},o=(0,r.lazy)(()=>t.loader().then(s)),c=t.loading;function d(e){let s=c?(0,n.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,a=t.ssr?(0,n.jsxs)(n.Fragment,{children:["undefined"==typeof window?(0,n.jsx)(i.PreloadCss,{moduleIds:t.modules}):null,(0,n.jsx)(o,{...e})]}):(0,n.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(o,{...e})});return(0,n.jsx)(r.Suspense,{fallback:s,children:a})}return d.displayName="LoadableComponent",d}},49:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return l}});let n=o(7437),r=o(544);function l(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let o=(0,r.getExpectedRequestStore)("next/dynamic css"),l=[];if(o.reactLoadableManifest&&t){let e=o.reactLoadableManifest;for(let o of t){if(!e[o])continue;let t=e[o].files.filter(e=>e.endsWith(".css"));l.push(...t)}}return 0===l.length?null:(0,n.jsx)(n.Fragment,{children:l.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:o.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=2829)}),_N_E=e.O()}]);