(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60],{192:function(e,o,t){Promise.resolve().then(t.bind(t,7891))},7891:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return l}});var r=t(7437),n=t(2265),i=t(536),s=t(724),c=t(2084),a=t(7648);function l(){let{currentSession:e}=(0,i.z)(),{voice:o,setVoice:t}=(0,s.M)(),{user:l}=(0,c.a)(),[d,u]=(0,n.useState)(!1),[g,h]=(0,n.useState)(null);return((0,n.useEffect)(()=>{(async()=>{try{if(l){let e=await fetch("/api/voice/check?userId=".concat(l.id));if(!(await e.json()).exists){console.log("Voice not found, sending webhook...");let e=await fetch("/api/auth/generate-token",{cache:"no-store",headers:{Accept:"application/json"}});if(!e.ok)throw Error("Token fetch failed: ".concat(e.status));let o=await e.json();if(!o.token)throw Error("No token received from server");let t=o.token,r={userId:l.id,userName:"".concat(l.firstName,"_").concat(l.lastName),event:"voice_missing"};console.log("Sending webhook with data:",r);try{let e=await fetch("/api/webhook",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw Error("Webhook failed with status: ".concat(e.status));let o=await e.json();console.log("Webhook response:",o)}catch(e){console.error("Webhook error:",e)}console.log("Webhook sent successfully")}}}catch(e){console.error("Error:",e),h(e instanceof Error?e.message:"An error occurred")}})()},[l]),d)?(0,r.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Processing Your Recordings"}),(0,r.jsx)("p",{children:"Please wait while we process your recordings..."})]})}):g?(0,r.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Error"}),(0,r.jsx)("p",{className:"text-red-500",children:g})]})}):(0,r.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Thank You!"}),(0,r.jsx)("p",{className:"mb-6",children:"Your recordings have been submitted successfully. Our team is now processing your voice profile."}),(0,r.jsx)("p",{className:"mb-6 text-slate-300",children:"Please allow approximately 30 minutes for processing. You will receive an email notification when your digital profile is ready for conversations."}),(0,r.jsx)(a.default,{href:"/",className:"inline-block bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-500 transition-colors",children:"Return to Home"})]})})}},536:function(e,o,t){"use strict";t.d(o,{c:function(){return c},z:function(){return a}});var r=t(7437),n=t(2265),i=t(9239);let s=(0,n.createContext)({currentSession:null,startNewSession:()=>{},addRecording:()=>{},replaceRecording:()=>{},getCurrentQuestionRecording:()=>void 0,goToNextQuestion:()=>{},goToPreviousQuestion:()=>!1,completeSession:async()=>{}});function c(e){let{children:o}=e,[t,c]=(0,n.useState)(null),a=async()=>{t&&c({...t,completedAt:new Date().toISOString()})};return(0,r.jsx)(s.Provider,{value:{currentSession:t,startNewSession:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=e.length>0?Math.max(...e.map(e=>e.questionIndex))+1:0;c({id:"session_".concat(Date.now()),questionIndex:o,recordings:Array.isArray(e)?e:[]})},addRecording:e=>{if(t)try{i.D.saveRecording(e);let o=[...t.recordings];o.push(e);let r={...t,recordings:o};c(r)}catch(e){throw console.error("Failed to save recording:",e),e}},replaceRecording:e=>{if(t)try{let o=t.recordings.findIndex(o=>o.questionIndex===e.questionIndex);if(-1!==o){i.D.replaceRecording(o,e);let r=[...t.recordings];r[o]=e;let n={...t,recordings:r};c(n)}}catch(e){throw console.error("Failed to replace recording:",e),e}},getCurrentQuestionRecording:()=>{if(t)return t.recordings.find(e=>e.questionIndex===t.questionIndex)},goToNextQuestion:()=>{t&&c({...t,questionIndex:t.questionIndex+1})},goToPreviousQuestion:()=>!!t&&0!==t.questionIndex&&(c({...t,questionIndex:t.questionIndex-1}),!0),completeSession:a},children:o})}let a=()=>(0,n.useContext)(s)},2084:function(e,o,t){"use strict";t.d(o,{a:function(){return c},d:function(){return s}});var r=t(7437),n=t(2265);let i=(0,n.createContext)(void 0),s=e=>{let{children:o}=e,[t,s]=(0,n.useState)(null),[c,a]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(()=>{try{let e=document.cookie.split("; ").find(e=>e.startsWith("userId="));if(e){let o=e.split("=")[1];console.log("Found user cookie with ID:",o),fetch("/api/user/login_credentials?userId=".concat(o)).then(e=>e.json()).then(e=>{if(!e.error){let o={id:e.userId,username:e.userId,firstName:e.firstName,middleName:e.middleName||"",lastName:e.lastName,email:e.email,phone:e.phoneNumber,dob:e.dateOfBirth};s(o),localStorage.setItem("aliveHereUser",JSON.stringify(o))}a(!1)}).catch(()=>{a(!1)});return}let o=localStorage.getItem("aliveHereUser");o&&(console.log("Loading user from localStorage"),s(JSON.parse(o)))}catch(e){console.error("Error loading user from storage:",e)}finally{a(!1)}})()},[]);let l=e=>{console.log("Setting user with ID:",null==e?void 0:e.id),e&&!e.id&&console.error("User object is missing ID field"),s(e),e?localStorage.setItem("aliveHereUser",JSON.stringify(e)):localStorage.removeItem("aliveHereUser")},d=async()=>{try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){console.error("Error during logout:",e)}finally{l(null),document.cookie="userId=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}},u=async e=>{try{l(e)}catch(e){throw console.error("Error registering user:",e),e}};return(0,r.jsx)(i.Provider,{value:{user:t,setUser:l,logout:d,isLoading:c,registerUser:u},children:o})},c=()=>{let e=(0,n.useContext)(i);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},724:function(e,o,t){"use strict";t.d(o,{E:function(){return c},M:function(){return s}});var r=t(7437),n=t(2265);let i=(0,n.createContext)({voice:null,setVoice:()=>{}}),s=()=>(0,n.useContext)(i);function c(e){let{children:o}=e,[t,s]=(0,n.useState)(null),[c,a]=(0,n.useState)(null),l={voiceId:"fallback",name:"Fallback Voice",status:"fallback",createdAt:new Date().toISOString(),userId:"",isElevenLabsVoice:!1};(0,n.useEffect)(()=>{if("/login"!==window.location.pathname&&"/registration"!==window.location.pathname)try{let e=localStorage.getItem("aliveHereVoice"),o=localStorage.getItem("userId");if(!o){console.log("Skipping voice initialization - no user logged in");return}if(console.log("VoiceProvider initializing, userId:",o),e){let t=JSON.parse(e);t&&t.voiceId?(console.log("Loading voice from storage:",t),s(t),o&&(console.log("Validating voice with API call"),d(o))):(console.log("Invalid voice data structure in localStorage"),o&&d(o))}else console.log("No voice data found in localStorage"),o&&d(o)}catch(e){console.error("Voice data initialization error:",e),a(e instanceof Error?e.message:"Unknown error"),s(l)}},[]);let d=async e=>{if(!e){console.error("Cannot check voice API: No user ID provided");return}try{console.log("Checking voice API for user:",e),a(null);let o=new Date().getTime(),t=await fetch("/api/voice/check?userId=".concat(e,"&t=").concat(o),{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(console.log("Voice API response status:",t.status),t.ok){let o=await t.json();if(console.log("Voice API returned data:",o),o.exists){console.log("Voice exists, creating voice data object");let t={voiceId:o.voiceId,name:o.name||"My Voice",status:o.status||"ready",createdAt:new Date().toISOString(),userId:e,isElevenLabsVoice:o.isElevenLabsVoice};if(console.log("Saving voice data to localStorage:",t),localStorage.setItem("aliveHereVoice",JSON.stringify(t)),s(t),o.isElevenLabsVoice&&o.voiceId)try{console.log("Fetching ElevenLabs voice details");let e=await fetch("/api/voice/fetch-from-elevenlabs?voiceId=".concat(o.voiceId));if(e.ok){let o=await e.json();console.log("ElevenLabs data:",o);let r={...t,elevenLabsData:o.voiceData};localStorage.setItem("aliveHereVoice",JSON.stringify(r)),s(r)}}catch(e){console.error("Error fetching ElevenLabs data:",e)}}else console.log("Voice API says voice does not exist"),s(l)}else{let e=await t.text();console.error("Voice check API error:",e),a("API error: ".concat(t.status," - ").concat(e)),s(l),localStorage.setItem("aliveHereVoice",JSON.stringify(l))}}catch(e){console.error("Error checking voice API:",e),a(e instanceof Error?e.message:"Unknown API error"),s(l)}};return(0,r.jsx)(i.Provider,{value:{voice:t,setVoice:s},children:o})}},9239:function(e,o,t){"use strict";t.d(o,{D:function(){return n}});class r{async saveRecording(e){try{this.recordings.push(e)}catch(e){throw console.error("Error saving recording:",e),Error((null==e?void 0:e.message)||"Failed to save recording")}}getSessionRecordings(){try{return this.recordings}catch(e){return console.error("Error getting recordings:",e),[]}}replaceRecording(e,o){try{this.recordings[e]=o}catch(e){throw console.error("Error replacing recording:",e),Error((null==e?void 0:e.message)||"Failed to replace recording")}}constructor(){this.recordings=[],this.RECORDINGS_KEY="recordings"}}let n=new r},7648:function(e,o,t){"use strict";t.d(o,{default:function(){return n.a}});var r=t(2972),n=t.n(r)}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=192)}),_N_E=e.O()}]);